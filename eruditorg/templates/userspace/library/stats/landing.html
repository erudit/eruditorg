{% extends "userspace/library/base.html" %}
{% load i18n %}

{% block title %}{% trans "Consultations" %} {{ block.super }}{% endblock title %}

{% block breadcrumb %}{{ block.super }}
<li xmlns="http://www.w3.org/1999/html"><a href="{% url 'userspace:library:stats:landing' organisation_pk=scope_current_organisation.pk %}">{% trans "Consultations" %}</a></li>
{% endblock breadcrumb %}

{% block section_title %}
{% trans "Consultations" %}
{% endblock %}

{% block data_controller %}userspace:library:stats:legacy:landing{% endblock data_controller %}


{% block section_intro %}
{% blocktrans %}
<p>Cette section vous donne accès aux statistiques de consultation de votre établissement pour les différentes revues souscrites. Les rapports disponibles respectent la norme COUNTER (R4), et nous mettons à votre disposition les rapports JR1 et JR1 GOA, aux formats CSV, XML ou HTML, par année d’abonnement ou pour la période de votre choix.</p>
{% endblocktrans %}
{% endblock section_intro %}

{% block section_aside %}
{% blocktrans %}
<p>Notez que les revues du fonds <strong>Centre for Digital Scholarship</strong> ne sont pas incluses dans ces rapports, car elles ne sont pas hébergées sur nos serveurs&nbsp;; il nous est impossible de compiler ces statistiques de consultation.</p>
<p>Consultez <a href="https://www.erudit.org/fr/revues/?collections=unb" target="_blank" title="Voir la liste des revues Centre for Digital Scholarship">la liste des titres concernés ici</a>.</p>
{% endblocktrans %}
{% endblock %}

{% block content_main %}
{% if last_valid_subscription %}
<div>

  <ul class="nav-tabs" role="tablist">
  {% for form in R4_forms %}
    <li role="presentation" class="{% ifequal active_form.prefix form.prefix %}active{% endifequal %}">
      <a href="#{{ form.prefix }}" aria-controls="{{ form.prefix }}" role="tab" data-toggle="tab">{{ form.form_info.title }}</a></li>
  {% endfor %}
  </ul>

  <div class="tab-content">
  {% for form in R4_forms %}
    <section role="tabpanel" class="tab-pane{% ifequal active_form.prefix form.prefix %} active{% endifequal %}" id="{{ form.prefix }}">
      <h2>{% trans "COUNTER" %} {{ form.form_info.counter_release }} <br> {{ form.form_info.title }}</h2>
      <div class="row">
        <div class="col-md-7">
          <p>{{ form.form_info.description }}</p>
        </div>
      </div>
      {% for error in form.errors.values %}
      {{ error }}
      {% endfor %}
      <form method="get">
        {{ form.report_type }}

        <fieldset>
          <h3>
            {% trans "Période" %}
          </h3>

          <div class="row form-group">
            <div class="col-xs-6 col-md-4">
              <label for="{{ form.year.auto_id }}">{% trans "Par année" %}</label>
              {{ form.year }}
            </div>
          </div>

          <div class="separator"><strong>{% trans "ou" %}</strong></div>

          <div class="row form-group">
            <div class="col-sm-3 col-md-4">
              <h4>{% trans "Début" %}</h4>
            </div>
            <div class="col-sm-9 col-md-8">
              <div class="row">
                <div class="col-xs-6">
                  <label for="{{ form.month_start.auto_id }}">{% trans "Mois" %}</label>
                  {{ form.month_start }}
                </div>
                <div class="col-xs-6">
                  <label for="{{ form.year_start.auto_id }}">{% trans "Année" %}</label>
                  {{ form.year_start }}
                </div>
              </div>
            </div>
          </div>

          <div class="row form-group">
            <div class="col-sm-3 col-md-4">
              <h4>{% trans "Fin" %}</h4>
            </div>
            <div class="col-sm-9 col-md-8">
              <div class="row">
                <div class="col-xs-6">
                  <label for="{{ form.month_end.auto_id }}">{% trans "Mois" %}</label>
                  {{ form.month_end }}
                </div>
                <div class="col-xs-6">
                  <label for="{{ form.year_end.auto_id }}">{% trans "Année" %}</label>
                  {{ form.year_end }}
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>
            <h3>{% trans "Format" %}</h3>
          </legend>
          <div class="row form-group">
            <div class="col-xs-6 col-md-4">
              <label for="{{ form.format.auto_id }}">{% trans "Format des données" %}</label>
              {{ form.format }}
            </div>
          </div>
        </fieldset>

        <button id="submit-id-submit" class="btn btn-primary" name="{{ form.form_info.submit_name }}" type="submit">{% trans 'Télécharger' %}</button>
      </form>

    </section>
  {% endfor %}
  </div>

</div>
{% else %}
<section>
  <div class="glory">
    {% blocktrans %}Vous n'avez jamais été abonné à la plateforme érudit{% endblocktrans %}
  </div>
</section>
{% endif %}

{% endblock content_main %}
