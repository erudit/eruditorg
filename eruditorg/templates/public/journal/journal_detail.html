{% extends "public/journal/journal_base.html" %}
{% load cache i18n model_formatters staticfiles %}

{% block title %}{{ journal.name|safe }}{% if journal.subtitle %}{% trans ' :' %} {{ journal.subtitle }}{% endif %}{% endblock title %}

{% block meta_description %}{% blocktrans with journal_about=journal_info.about|safe|striptags|truncatechars:175 %}{{ journal_about }}{% endblocktrans %}{% endblock meta_description %}

{% block meta_tags %}
<!-- Facebook / Open Graph -->
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:type" content="website">
<meta property="og:title" content="{{ journal.name|safe }}{% if journal.subtitle %}{% trans ' :' %} {{ journal.subtitle|safe }}{% endif %}">
<meta property="og:site_name" content="Érudit">
<meta property="og:locale" content="{{ language_code }}_CA">
<meta property="og:image" content="{% if request.is_secure %}https://{% else %}http://{% endif %}{{ request.get_host }}{% url 'public:journal:journal_logo' journal.code %}">
<meta property="og:description" content="{% blocktrans with journal_about=journal_info.about|safe|striptags|truncatechars:175 %}{{ journal_about }}{% endblocktrans %}">

<!-- Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@eruditorg">
<meta name="twitter:url" content="{{ request.build_absolute_uri }}">
<meta name="twitter:title" content="{{ journal.name|safe }}{% if journal.subtitle %}{% trans ' :' %} {{ journal.subtitle|safe }}{% endif %} – Érudit">
<meta name="twitter:image:alt" content="{% trans 'Logo pour' %} {{ journal.name|safe }}">
<meta name="twitter:image" content="{% if request.is_secure %}https://{% else %}http://{% endif %}{{ request.get_host }}{% url 'public:journal:journal_logo' journal.code %}">
<meta name="twitter:description" content="{% blocktrans with journal_about=journal_info.about|safe|striptags|truncatechars:175 %}{{ journal_about }}{% endblocktrans %}">
{% endblock meta_tags %}

{% block structured_data %}
{{ block.super }}
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
    "@type": "ListItem",
    "position": 1,
    "item": {
      "@id": "{{ request.scheme }}://{{ request.site.domain }}",
      "name": "Érudit"
    }
  },{
    "@type": "ListItem",
    "position": 2,
    "item": {
      "@id": "{{ request.scheme }}://{{ request.site.domain }}{% url 'public:journal:journal_list' %}",
      "name": "{% trans 'Revues' %}"
    }
  },{
    "@type": "ListItem",
    "position": 3,
    "item": {
      "@id": "{{ request.scheme }}://{{ request.site.domain }}{% url 'public:journal:journal_detail' journal.code %}",
      "name": "{{ journal.name }}"
    }
  }]
}
</script>
{% endblock structured_data %}

{% block body_id %}journal_detail{% endblock body_id %}
{% block data_controller %}public:journal:journal_detail{% endblock data_controller %}

{% block inner_main %}
<main role="main" class="col-sm-8 col-md-7">
  <header class="main-header row">
    <div class="col-sm-12">
      {# Title #}
      <div class="row">
        <h1>
          <div class="col-xs-10 col-sm-9">
            <span class="journal-title">{% if main_title %}{{ main_title.title }}{% else %}{{ journal.name }}{% endif %}</span>
            {% if main_title.subtitle %}<span class="journal-subtitle">{{ main_title.subtitle }}</span>{% endif %}
            {% for title in paral_titles %}
            {% if title.title != main_title.title %}
            <span class="journal-title">{{ title.title }}</span>
            {% endif %}
            {% if title.subtitle and title.subtitle != main_title.subtitle %}<span class="journal-subtitle">{{ title.subtitle }}</span>{% endif %}
            {% endfor %}
          </div>
          {# Peer review seal & access type #}
          <div class="col-xs-2 col-sm-3 text-right">
            {% if journal.type.code == 'S' %}
            <span class="hint--bottom-left hint--no-animate" data-hint="{% trans 'Tous les articles de cette revue sont soumis à un processus d’évaluation par les pairs.' %}">
              <ion-icon name="ios-checkmark-circle"></ion-icon>
            </span>
            {% endif %}
            {% if journal.open_access %}
            <span class="hint--bottom-left hint--no-animate" data-hint="{% trans 'Les numéros courants et les archives de cette revue sont disponibles en libre accès.' %}">
              <span class="erudicon erudicon-open-access"></span>
            </span>
            {% endif %}
          </div>
        </h1>
      </div>
      <div class="main-header__intro">
        {# Directors and editors #}
        <p>
          {% with directors=meta_info_issue.erudit_object.get_directors editors=meta_info_issue.erudit_object.get_editors %}
          {% if directors %}
          {% trans "Direction&nbsp;:" %}
          {% for issue_contributor in directors %}{% if not forloop.first %}, {% endif %}{{ issue_contributor.format_name }}{% endfor %}
          {% endif %}
          {% if directors and editors %}/{% endif %}
          {% if editors %}
          {% trans "Rédaction&nbsp;:" %}
          {% for issue_contributor in editors %}{% if not forloop.first %}, {% endif %}{{ issue_contributor | format_editor }}</dd>{% endfor %}
          {% endif %}
          {% endwith %}
        </p>

        {# History #}
        {% if journal.previous_journal or journal.next_journal %}
        <p>
          {% if journal.previous_journal %}
          <span>{% trans "Revue précédée de" %}</span>
          <strong>
            <a href="{% url 'public:journal:journal_detail' journal.previous_journal.code %}">
              {{ journal.previous_journal.name }}{% if journal.previous_journal.subtitle %}{% trans '&nbsp;:' %} {{ journal.previous_journal.subtitle }}{% endif %}
            </a>
          </strong>
          {% endif %}
          {% if journal.next_journal %}
          <span>{% trans "Revue suivie de" %}</span>
          <strong>
            <a href="{% url 'public:journal:journal_detail' journal.next_journal.code %}">
              {{ journal.next_journal.name }}{% if journal.next_journal.subtitle %}{% trans '&nbsp;:' %} {{ journal.next_journal.subtitle }}{% endif %}
            </a>
          </strong>
          {% endif %}
        </p>
        {% endif %}
      </div>
    </div>
  </header>

  {% if journal_info or issues %}
  <ul class="nav-tabs" role="tablist">
    {% if journal_info.about %}<li role="presentation" class="active"><a href="#journal-info-about" role="tab" data-toggle="tab">{% trans "À propos" %}</a></li>{% endif %}

    {% if issues %}<li role="presentation"><a href="#back-issues" role="tab" data-toggle="tab">{% trans "Numéros" %}</a></li>{% endif %}

    {% if journal_info.editorial_policy %}<li role="presentation"><a href="#journal-info-editorial_policy" role="tab" data-toggle="tab">{% trans "Politique éditoriale et éthique" %}</a></li>{% endif %}

    {% if journal_info.team %}<li role="presentation"><a href="#journal-info-team" role="tab" data-toggle="tab">{% trans "Comité de rédaction" %}</a></li>{% endif %}

  </ul>

  <div class="tab-content">
    <section role="tabpanel" class="tab-pane active journal-info-block" id="journal-info-about">
      {% if journal_info.about %}{{ journal_info.about|safe }}{% endif %}
      {% if journal_info.contact %}{{ journal_info.contact|safe }}{% endif %}
    </section>

    {% if issues %}
    <section role="tabpanel" class="tab-pane" id="back-issues">
      {% cache LONG_TTL "public_journal_detail_issues" journal.id content_access_granted LANGUAGE_CODE %}
      <h2>{% trans "Historique de la revue" %} ({{ issues|length }}&nbsp;{% trans "numéros" %})</h2>
      {% if journal.collection.code == 'erudit' %}
      <div class="alert alert-info">
        <p><ion-icon name="information-circle" class="alert-info-icon"></ion-icon>
          {% blocktrans %}
            L’archivage pérenne des articles sur Érudit est assuré par <a href="https://www.portico.org/" target="_blank">Portico</a>.
          {% endblocktrans %}
        </p>
      </div>
      {% endif %}
      {% regroup issues|dictsortreversed:"year" by year as year_list %}
      <ul class="year-list">
        {% for year in year_list %}
        <li class="year-list__item"><h3 class="year-list__title">{{ year.grouper }}</h3>
          <ul class="issue-list">
            {% for issue in year.list %}
            {% cache FOREVER_TTL "public_journal_detail_issues_item" issue.id content_access_granted LANGUAGE_CODE %}
            <li class="issue-list__item">
              <a {{ issue.extra.detail_link_attrs }}>
                {% if issue.extra.is_locked %}<ion-icon name="ios-lock"></ion-icon>&nbsp;{% endif %}<span>{% with title=issue.volume_title %}{{ title }}{% endwith %}</span>
                {% if issue.html_title %}<br/><span class="issue-list__theme">{{ issue.html_title|safe }}</span>{% endif %}
              </a>
            </li>
            {% endcache %}
            {% endfor %}
          </ul>
        </li>
        {% endfor %}
      </ul>
      {% if issues|length > 50 %}
      <div class="text-center">
        <a href="#back-issues" class="scroll-issues" title="{% trans 'Retourner en haut' %}">|^</a>
      </div>
      {% endif %}
      {% endcache %}
    </section>
    {% endif %}

    {% if journal_info.editorial_policy %}
    <section role="tabpanel" class="tab-pane journal-info-block" id="journal-info-editorial_policy">
      {{ journal_info.editorial_policy|safe }}
    </section>
    {% endif %}

    {% if journal_info.team %}
    <section role="tabpanel" class="tab-pane journal-info-block" id="journal-info-team">
      {{ journal_info.team|safe }}
    </section>
    {% endif %}

    {% if journal_info.contact %}
    <section role="tabpanel" class="tab-pane journal-info-block" id="journal-info-contact">
      {{ journal_info.contact|safe }}
    </section>
    {% endif %}

  </div>
  {% endif %}

</main>
{% endblock inner_main %}
